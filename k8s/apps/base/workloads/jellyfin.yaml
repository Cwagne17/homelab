# =============================================================================
# Jellyfin Application
#
# Installs Jellyfin media server for streaming movies, TV shows, and music.
#
# TODO: Define manifests in k8s/configs/jellyfin/ or use Helm chart
# =============================================================================
---
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: jellyfin
  namespace: argocd
  labels:
    app.kubernetes.io/name: jellyfin
    app.kubernetes.io/part-of: workloads
spec:
  project: workloads

  source:
    # TODO: Either use a Helm chart or point to raw manifests in this repo
    # Option 1: Helm chart (if available)
    # repoURL: https://k8s-at-home.com/charts/
    # chart: jellyfin
    # targetRevision: 9.5.3

    # Option 2: Raw manifests in this repo
    repoURL: https://github.com/cwagne17/homelab.git
    targetRevision: HEAD
    path: k8s/configs/jellyfin

    # helm:
    #   values: |
    #     # TODO: Configure Jellyfin values
    #     image:
    #       repository: jellyfin/jellyfin
    #       tag: 10.8.13
    #
    #     persistence:
    #       config:
    #         enabled: true
    #         size: 10Gi
    #       media:
    #         enabled: true
    #         size: 500Gi  # Or mount existing NFS/storage
    #
    #     resources:
    #       requests:
    #         cpu: 500m
    #         memory: 1Gi

  destination:
    server: https://kubernetes.default.svc
    namespace: jellyfin

  syncPolicy:
    automated:
      prune: true
      selfHeal: true
    syncOptions:
      - CreateNamespace=true
      - ServerSideApply=true

  revisionHistoryLimit: 5
