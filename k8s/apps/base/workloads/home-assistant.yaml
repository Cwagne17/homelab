# =============================================================================
# Home Assistant Application
#
# Installs Home Assistant for smart home automation.
#
# TODO: Define manifests in k8s/configs/home-assistant/ or use Helm chart
# =============================================================================
---
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: home-assistant
  namespace: argocd
  labels:
    app.kubernetes.io/name: home-assistant
    app.kubernetes.io/part-of: workloads
spec:
  project: workloads

  source:
    # TODO: Either use a Helm chart or point to raw manifests in this repo
    # Option 1: Helm chart
    # repoURL: https://k8s-at-home.com/charts/
    # chart: home-assistant
    # targetRevision: 13.4.2

    # Option 2: Raw manifests in this repo
    repoURL: https://github.com/cwagne17/homelab.git
    targetRevision: HEAD
    path: k8s/configs/home-assistant

    # helm:
    #   values: |
    #     # TODO: Configure Home Assistant values
    #     image:
    #       repository: ghcr.io/home-assistant/home-assistant
    #       tag: 2024.1.0
    #
    #     persistence:
    #       config:
    #         enabled: true
    #         size: 10Gi
    #
    #     resources:
    #       requests:
    #         cpu: 100m
    #         memory: 512Mi

  destination:
    server: https://kubernetes.default.svc
    namespace: home-assistant

  syncPolicy:
    automated:
      prune: true
      selfHeal: true
    syncOptions:
      - CreateNamespace=true
      - ServerSideApply=true

  revisionHistoryLimit: 5
