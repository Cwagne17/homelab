# =============================================================================
# NetBox Application
#
# Installs NetBox for infrastructure resource modeling (DCIM/IPAM).
#
# TODO: Define manifests in k8s/configs/netbox/ or use Helm chart
# =============================================================================
---
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: netbox
  namespace: argocd
  labels:
    app.kubernetes.io/name: netbox
    app.kubernetes.io/part-of: workloads
spec:
  project: workloads

  source:
    # TODO: Either use a Helm chart or point to raw manifests in this repo
    # Option 1: Helm chart
    # repoURL: https://charts.boo.tc
    # chart: netbox
    # targetRevision: 4.1.1

    # Option 2: Raw manifests in this repo
    repoURL: https://github.com/cwagne17/homelab.git
    targetRevision: HEAD
    path: k8s/configs/netbox

    # helm:
    #   values: |
    #     # TODO: Configure NetBox values
    #     replicaCount: 1
    #
    #     postgresql:
    #       enabled: true
    #       auth:
    #         password: changeme  # TODO: Use secret
    #
    #     redis:
    #       enabled: true
    #
    #     persistence:
    #       enabled: true
    #       size: 10Gi
    #
    #     resources:
    #       requests:
    #         cpu: 100m
    #         memory: 256Mi

  destination:
    server: https://kubernetes.default.svc
    namespace: netbox

  syncPolicy:
    automated:
      prune: true
      selfHeal: true
    syncOptions:
      - CreateNamespace=true
      - ServerSideApply=true

  revisionHistoryLimit: 5
