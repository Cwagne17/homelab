# =============================================================================
# AlmaLinux 9 Kickstart Configuration - MINIMAL VERSION
# =============================================================================

# Installation method
text
cdrom

# Accept EULA
eula --agreed

# Reboot after installation
reboot --eject

# Localization
lang en_US.UTF-8
keyboard us
timezone UTC --utc

# Network - using static IP so Packer can find it
network --bootproto=static --device=link --ip=10.23.45.200 --netmask=255.255.255.0 --gateway=10.23.45.1 --nameserver=10.23.45.1 --onboot=yes --activate
network --hostname=packer-alma9

# Security - disabled for initial setup, provisioners can harden later
rootpw --plaintext packer
firewall --disabled
selinux --permissive
firstboot --disabled

# Partitioning
# zerombr: initialize any invalid partition tables (required for new disks)
# clearpart: wipe all existing partitions
# autopart: automatically create partitions using LVM
#   - Creates /boot, /boot/efi (for UEFI), and LVM volume group
#   - LVM allows flexible resizing and snapshots
# bootloader: install GRUB2 to Master Boot Record
zerombr
clearpart --all --initlabel
autopart --type=lvm
bootloader --location=mbr

# Packages
%packages
@core
openssh-server
%end

# Post-install
%post
systemctl enable sshd
sed -i 's/^#PermitRootLogin.*/PermitRootLogin yes/' /etc/ssh/sshd_config
sed -i 's/^PasswordAuthentication.*/PasswordAuthentication yes/' /etc/ssh/sshd_config
%end
