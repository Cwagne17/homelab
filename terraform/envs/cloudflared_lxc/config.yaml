# =============================================================================
# cloudflared Configuration File Template
#
# This file is used as a template by Terraform to generate the cloudflared
# configuration. It will be placed at /etc/cloudflared/config.yaml in the LXC.
#
# The tunnel configuration is managed remotely through Cloudflare's API
# (cloudflare_tunnel_config resource), so this local config only needs to
# specify the tunnel and credentials.
#
# =============================================================================

# Tunnel identifier - matches the Cloudflare tunnel resource
tunnel: ${tunnel_id}

# Path to the credentials file containing tunnel secret
credentials-file: /etc/cloudflared/credentials.json

# Metrics server for monitoring (optional)
# metrics: localhost:9090

# Logging configuration
# loglevel: info

# -----------------------------------------------------------------------------
# Ingress Rules
#
# NOTE: When using remotely-managed tunnel configuration (cloudflare_tunnel_config),
# ingress rules are managed through Cloudflare's dashboard/API, not this file.
#
# If you prefer locally-managed configuration, uncomment the ingress section below
# and remove the cloudflare_tunnel_config resource from cloudflare.tf.
# -----------------------------------------------------------------------------

# ingress:
%{ for rule in ingress_rules ~}
#   - hostname: ${rule.hostname}
#     service: ${rule.service}
%{ if rule.no_tls_verify ~}
#     originRequest:
#       noTLSVerify: true
%{ endif ~}
%{ endfor ~}
#   # Catch-all rule - required
#   - service: http_status:404
